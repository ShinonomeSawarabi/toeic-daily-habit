<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOEICæ®µéšçš„ç¿’æ…£ãƒˆãƒ©ãƒƒã‚«ãƒ¼ v2</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .phone-container {
            width: 100%;
            max-width: 375px;
            height: 812px;
            background: white;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .status-bar {
            height: 44px;
            background: #f8f9fa;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            font-size: 12px;
            color: #666;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
        }

        .level-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .level-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .level-subtitle {
            font-size: 13px;
            opacity: 0.9;
        }

        .progress-section {
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
            padding: 15px;
            margin-top: 15px;
        }

        .overall-progress {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .progress-text {
            font-size: 13px;
            font-weight: 600;
        }

        .progress-bar-outer {
            width: 100%;
            height: 10px;
            background: rgba(255,255,255,0.3);
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-bar-inner {
            height: 100%;
            background: white;
            border-radius: 5px;
            transition: width 0.3s ease;
        }

        .content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .achievements-section {
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            color: white;
        }

        .achievements-header {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .crown-display {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .crown-item {
            background: rgba(255,255,255,0.2);
            padding: 10px 15px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .crown-icon {
            font-size: 24px;
        }

        .crown-info {
            display: flex;
            flex-direction: column;
        }

        .crown-level {
            font-size: 12px;
            font-weight: 600;
        }

        .crown-date {
            font-size: 10px;
            opacity: 0.8;
        }

        .current-task {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 20px;
            padding: 25px;
            color: white;
            margin-bottom: 20px;
        }

        .task-header {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .task-title {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 10px;
            line-height: 1.3;
        }

        .task-meta {
            display: flex;
            gap: 15px;
            font-size: 14px;
            margin-top: 15px;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .check-button {
            width: 100%;
            background: white;
            color: #f5576c;
            border: none;
            padding: 15px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            margin-top: 15px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .check-button:active {
            transform: scale(0.98);
        }

        .check-button.completed {
            background: rgba(255,255,255,0.3);
            color: white;
        }

        .history-section {
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
        }

        .calendar-day {
            aspect-ratio: 1;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            background: #f0f0f0;
            color: #999;
            position: relative;
        }

        .calendar-day.completed {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .calendar-day.today {
            border: 2px solid #667eea;
        }

        .calendar-day.missed {
            background: #ffe0e0;
            color: #ff6b6b;
        }

        .level-list {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 15px;
        }

        .level-item {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            transition: all 0.2s;
            border: 2px solid transparent;
            position: relative;
        }

        .level-item.current {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .level-item.completed {
            opacity: 0.9;
            background: #fffef0;
        }

        .level-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .level-name {
            font-weight: 700;
            color: #333;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .crown-badge {
            font-size: 20px;
            animation: bounce 0.5s ease;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .level-status {
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 10px;
            font-weight: 600;
        }

        .level-status.current {
            background: #667eea;
            color: white;
        }

        .level-status.completed {
            background: #ffd700;
            color: #333;
        }

        .level-status.locked {
            background: #e0e0e0;
            color: #999;
        }

        .level-description {
            font-size: 13px;
            color: #666;
            line-height: 1.4;
        }

        .level-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .level-action-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .level-action-btn.edit {
            background: #667eea;
            color: white;
        }

        .level-action-btn.reset {
            background: #ff6b6b;
            color: white;
        }

        .level-action-btn:active {
            transform: scale(0.95);
        }

        .bottom-nav {
            height: 70px;
            background: white;
            border-top: 1px solid #e9ecef;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding-bottom: 10px;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            color: #999;
            font-size: 11px;
            cursor: pointer;
            transition: color 0.2s;
        }

        .nav-item.active {
            color: #667eea;
        }

        .nav-icon {
            font-size: 24px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 320px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:active {
            background: #5568d3;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #666;
        }

        .btn-secondary:active {
            background: #d0d0d0;
        }

        .btn-danger {
            background: #ff6b6b;
            color: white;
        }

        .btn-danger:active {
            background: #ff5252;
        }

        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 40px;
            border-radius: 20px;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            transition: transform 0.3s ease;
            pointer-events: none;
            z-index: 2000;
            max-width: 300px;
        }

        .celebration.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 28px;
            font-weight: bold;
            color: #667eea;
            display: block;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        .reset-section {
            background: #fff5f5;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border: 2px solid #ff6b6b;
        }

        .reset-warning {
            font-size: 14px;
            color: #ff6b6b;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .share-button {
            width: 100%;
            background: #1da1f2;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            margin-top: 10px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .share-button:active {
            transform: scale(0.98);
            background: #1a91da;
        }

        .share-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .tweet-preview {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #e1e8ed;
        }

        .tweet-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .tweet-avatar {
            width: 40px;
            height: 40px;
            background: #667eea;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .tweet-username {
            font-weight: 600;
            color: #333;
        }

        .tweet-text {
            font-size: 15px;
            line-height: 1.5;
            color: #333;
            white-space: pre-wrap;
        }

        .tweet-hashtag {
            color: #1da1f2;
        }

        .char-counter {
            text-align: right;
            font-size: 12px;
            color: #999;
            margin-top: 8px;
        }

        .char-counter.warning {
            color: #ff6b6b;
        }

    </style>
</head>
<body>
    <div class="phone-container">
        <div class="status-bar">
            <span id="currentTime">9:41</span>
            <span>ğŸ”‹ 100%</span>
        </div>

        <div class="header">
            <div class="level-badge">ğŸ¯ <span id="headerLevel">Level 1</span></div>
            <div class="level-title" id="headerTitle">åŸºç¤å›ºã‚æœŸ</div>
            <div class="level-subtitle" id="headerSubtitle">è‹±å˜èªã‚’ç¢ºå®Ÿã«è¦šãˆã‚ˆã†</div>
            
            <div class="progress-section">
                <div class="overall-progress">
                    <span class="progress-text">é€²æ—: <span id="headerProgress">0/10æ—¥</span></span>
                    <span class="progress-text"><span id="headerPercent">0</span>%</span>
                </div>
                <div class="progress-bar-outer">
                    <div class="progress-bar-inner" id="headerProgressBar" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- ãƒ›ãƒ¼ãƒ ç”»é¢ -->
        <div class="content view active" id="homeView">
            <!-- å®Ÿç¸¾ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="achievements-section" id="achievementsSection" style="display: none;">
                <div class="achievements-header">
                    <span>ğŸ‘‘</span>
                    <span>ç²å¾—ã—ãŸç‹å† </span>
                </div>
                <div class="crown-display" id="crownDisplay"></div>
            </div>

            <div class="current-task">
                <div class="task-header">ä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯</div>
                <div class="task-title" id="taskTitle">è‹±å˜èªã‚’10å€‹è¦šãˆã‚‹</div>
                <div class="task-meta">
                    <div class="meta-item">
                        <span>ğŸ“…</span>
                        <span id="taskDay">1/10æ—¥ç›®</span>
                    </div>
                    <div class="meta-item">
                        <span>ğŸ”¥</span>
                        <span id="taskStreak">é€£ç¶š0æ—¥</span>
                    </div>
                </div>
                <button class="check-button" id="completeButton" onclick="completeTask()">
                    âœ“ ä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯å®Œäº†
                </button>
                <button class="share-button" id="shareButton" onclick="openShareModal()" disabled>
                    ğŸ¦ Xã§æˆæœã‚’å ±å‘Šã™ã‚‹
                </button>
            </div>

            <div class="history-section">
                <div class="section-title">
                    <span>ğŸ“Š ä»Šæœˆã®å±¥æ­´</span>
                    <span style="font-size: 14px; color: #999;" id="monthCompleted">0/0æ—¥</span>
                </div>
                <div class="calendar-grid" id="calendar"></div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-number" id="totalDays">0</span>
                    <span class="stat-label">ç·å­¦ç¿’æ—¥æ•°</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="currentStreak">0</span>
                    <span class="stat-label">ç¾åœ¨ã®é€£ç¶š</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="longestStreak">0</span>
                    <span class="stat-label">æœ€é•·é€£ç¶š</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="completionRate">0</span>
                    <span class="stat-label">é”æˆç‡(%)</span>
                </div>
            </div>
        </div>

        <!-- ãƒ¬ãƒ™ãƒ«ä¸€è¦§ç”»é¢ -->
        <div class="content view" id="levelsView">
            <div class="level-list" id="levelList"></div>
        </div>

        <!-- è¨­å®šç”»é¢ -->
        <div class="content view" id="settingsView">
            <div class="level-list">
                <div class="section-title" style="margin-bottom: 15px;">ãƒ¬ãƒ™ãƒ«è¨­å®š</div>
                <div id="settingsLevelList"></div>
                <button class="btn btn-primary" style="width: 100%; margin-top: 15px;" onclick="addNewLevel()">
                    â• æ–°ã—ã„ãƒ¬ãƒ™ãƒ«ã‚’è¿½åŠ 
                </button>
                <button class="btn btn-secondary" style="width: 100%; margin-top: 10px;" onclick="resetToDefault()">
                    ğŸ”„ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™
                </button>
            </div>

            <!-- ãƒªã‚»ãƒƒãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="reset-section">
                <div class="section-title" style="margin-bottom: 10px; color: #ff6b6b;">âš ï¸ ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ</div>
                <div class="reset-warning">
                    âš ï¸ è­¦å‘Š: ãƒªã‚»ãƒƒãƒˆã™ã‚‹ã¨å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚æ…é‡ã«æ“ä½œã—ã¦ãã ã•ã„ã€‚
                </div>
                <button class="btn btn-danger" style="width: 100%; margin-bottom: 10px;" onclick="confirmResetAll()">
                    ğŸ—‘ï¸ å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ
                </button>
            </div>
        </div>

        <div class="bottom-nav">
            <div class="nav-item active" onclick="switchView('home')">
                <div class="nav-icon">ğŸ </div>
                <span>ãƒ›ãƒ¼ãƒ </span>
            </div>
            <div class="nav-item" onclick="switchView('levels')">
                <div class="nav-icon">ğŸ“ˆ</div>
                <span>ãƒ¬ãƒ™ãƒ«</span>
            </div>
            <div class="nav-item" onclick="switchView('settings')">
                <div class="nav-icon">âš™ï¸</div>
                <span>è¨­å®š</span>
            </div>
        </div>
    </div>

    <!-- ãƒ¬ãƒ™ãƒ«ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">ãƒ¬ãƒ™ãƒ«ç·¨é›†</div>
            <div class="form-group">
                <label class="form-label">ãƒ¬ãƒ™ãƒ«å</label>
                <input type="text" class="form-input" id="editLevelName" placeholder="Level 1">
            </div>
            <div class="form-group">
                <label class="form-label">ã‚¿ã‚¤ãƒˆãƒ«</label>
                <input type="text" class="form-input" id="editTitle" placeholder="åŸºç¤å›ºã‚æœŸ">
            </div>
            <div class="form-group">
                <label class="form-label">èª¬æ˜</label>
                <input type="text" class="form-input" id="editSubtitle" placeholder="è‹±å˜èªã‚’ç¢ºå®Ÿã«è¦šãˆã‚ˆã†">
            </div>
            <div class="form-group">
                <label class="form-label">ã‚¿ã‚¹ã‚¯å†…å®¹</label>
                <textarea class="form-textarea" id="editTask" placeholder="è‹±å˜èªã‚’10å€‹è¦šãˆã‚‹"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">å¿…è¦æ—¥æ•°</label>
                <input type="number" class="form-input" id="editDays" placeholder="10" min="1">
            </div>
            <div class="button-group">
                <button class="btn btn-secondary" onclick="closeEditModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="btn btn-primary" onclick="saveLevel()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <div class="modal-header" id="confirmTitle">ç¢ºèª</div>
            <div style="color: #666; margin-bottom: 20px; line-height: 1.5;" id="confirmMessage"></div>
            <div class="button-group">
                <button class="btn btn-secondary" onclick="closeConfirmModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="btn btn-danger" id="confirmButton">å®Ÿè¡Œ</button>
            </div>
        </div>
    </div>

    <!-- XæŠ•ç¨¿ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="shareModal">
        <div class="modal-content">
            <div class="modal-header">ğŸ¦ Xã§æˆæœã‚’å ±å‘Š</div>
            
            <div class="tweet-preview">
                <div class="tweet-header">
                    <div class="tweet-avatar">ğŸ“š</div>
                    <div class="tweet-username">ã‚ãªãŸ</div>
                </div>
                <div class="tweet-text" id="tweetPreview"></div>
                <div class="char-counter" id="charCounter">0 / 280</div>
            </div>

            <div style="font-size: 13px; color: #999; margin-bottom: 15px;">
                âœ“ å†…å®¹ã‚’ç¢ºèªã—ã¦ã‹ã‚‰æŠ•ç¨¿ã—ã¦ãã ã•ã„
            </div>

            <div class="button-group">
                <button class="btn btn-secondary" onclick="closeShareModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="btn btn-primary" onclick="postToX()" style="background: #1da1f2;">
                    ğŸ¦ Xã«æŠ•ç¨¿
                </button>
            </div>
        </div>
    </div>

    <!-- ãŠç¥ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
    <div class="celebration" id="celebration"></div>

    <script>
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¬ãƒ™ãƒ«å®šç¾©
        const DEFAULT_LEVELS = [
            {
                id: 1,
                name: "Level 1",
                title: "åŸºç¤å›ºã‚æœŸ",
                subtitle: "è‹±å˜èªã‚’ç¢ºå®Ÿã«è¦šãˆã‚ˆã†",
                task: "è‹±å˜èªã‚’10å€‹è¦šãˆã‚‹",
                requiredDays: 10
            },
            {
                id: 2,
                name: "Level 2",
                title: "æ–‡æ³•ãƒ‰ãƒªãƒ«æœŸ",
                subtitle: "åŸºæœ¬æ–‡æ³•ã‚’å®šç€ã•ã›ã‚ˆã†",
                task: "æ–‡æ³•ãƒ‰ãƒªãƒ«5å•ã‚’è§£ã",
                requiredDays: 10
            },
            {
                id: 3,
                name: "Level 3",
                title: "å˜èªåŠ›å¼·åŒ–æœŸ",
                subtitle: "èªå½™ã‚’ä¸€æ°—ã«å¢—ã‚„ãã†",
                task: "è‹±å˜èªã‚’30å€‹è¦šãˆã‚‹",
                requiredDays: 14
            },
            {
                id: 4,
                name: "Level 4",
                title: "Part 7 å¼·åŒ–æœŸ",
                subtitle: "é•·æ–‡èª­è§£åŠ›ã‚’é›ãˆã‚ˆã†",
                task: "Part 7ã‚’10å•è§£ã",
                requiredDays: 15
            },
            {
                id: 5,
                name: "Level 5",
                title: "ç·åˆæ¼”ç¿’æœŸ",
                subtitle: "å…¨ãƒ‘ãƒ¼ãƒˆã‚’ãƒãƒ©ãƒ³ã‚¹ã‚ˆã",
                task: "æ¨¡è©¦1ã‚»ãƒƒãƒˆï¼ˆ200å•ï¼‰ã‚’æ™‚é–“å†…ã«è§£ã",
                requiredDays: 7
            },
            {
                id: 6,
                name: "Level 6",
                title: "å¼±ç‚¹å…‹æœæœŸ",
                subtitle: "è‹¦æ‰‹ãƒ‘ãƒ¼ãƒˆã‚’é›†ä¸­æ”»ç•¥",
                task: "è‹¦æ‰‹ãƒ‘ãƒ¼ãƒˆã‚’50å•è§£ã + å¾©ç¿’",
                requiredDays: 10
            }
        ];

        let appData = {
            currentLevel: 1,
            levels: [],
            history: {},
            achievements: [], // ç‹å† ã®è¨˜éŒ²
            stats: {
                totalDays: 0,
                currentStreak: 0,
                longestStreak: 0
            }
        };

        let editingLevelId = null;
        let confirmCallback = null;

        // åˆæœŸåŒ–
        function init() {
            loadData();
            updateTime();
            setInterval(updateTime, 60000);
            updateAllUI();
        }

        // æ™‚åˆ»æ›´æ–°
        function updateTime() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('currentTime').textContent = `${hours}:${minutes}`;
        }

        // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        function loadData() {
            const saved = localStorage.getItem('toeicProgressTracker');
            if (saved) {
                appData = JSON.parse(saved);
                if (!appData.levels || appData.levels.length === 0) {
                    appData.levels = JSON.parse(JSON.stringify(DEFAULT_LEVELS));
                } else {
                    // ã§ã‚‹1000ãƒ¬ãƒ™ãƒ«ã‚’localStorageã‹ã‚‰é™¤å»ã—ã€IDã‚’æŒ¯ã‚Šç›´ã™
                    const hasDeruLevels = appData.levels.some(l =>
                        (l.title || '').includes('ã§ã‚‹1000') ||
                        (l.task || '').includes('ã§ã‚‹1000') ||
                        (l.name || '').includes('ã§ã‚‹1000')
                    );
                    if (hasDeruLevels) {
                        const oldIdToNew = {};
                        const filtered = appData.levels.filter(l =>
                            !(l.title || '').includes('ã§ã‚‹1000') &&
                            !(l.task || '').includes('ã§ã‚‹1000') &&
                            !(l.name || '').includes('ã§ã‚‹1000')
                        );
                        filtered.forEach((l, i) => {
                            oldIdToNew[l.id] = i + 1;
                            l.id = i + 1;
                            l.name = 'Level ' + (i + 1);
                        });
                        appData.levels = filtered;
                        if (oldIdToNew[appData.currentLevel] !== undefined) {
                            appData.currentLevel = oldIdToNew[appData.currentLevel];
                        } else {
                            appData.currentLevel = filtered.length > 0 ? filtered[0].id : 1;
                        }
                        Object.keys(appData.history).forEach(date => {
                            const oldId = appData.history[date].levelId;
                            if (oldIdToNew[oldId] !== undefined) {
                                appData.history[date].levelId = oldIdToNew[oldId];
                            }
                        });
                        if (appData.achievements) {
                            appData.achievements = appData.achievements.filter(a =>
                                oldIdToNew[a.levelId] !== undefined
                            );
                            appData.achievements.forEach(a => {
                                a.levelId = oldIdToNew[a.levelId];
                            });
                        }
                        localStorage.setItem('toeicProgressTracker', JSON.stringify(appData));
                    }
                }
                if (!appData.achievements) {
                    appData.achievements = [];
                }
            } else {
                appData.levels = JSON.parse(JSON.stringify(DEFAULT_LEVELS));
                appData.achievements = [];
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ä¿å­˜
        function saveData() {
            localStorage.setItem('toeicProgressTracker', JSON.stringify(appData));
        }

        // æ—¥ä»˜ã‚’JST(UTC+9)ã®æ—¥ä»˜æ–‡å­—åˆ—ã«å¤‰æ›
        function getJSTDateString(date) {
            const jstOffset = 9 * 60 * 60 * 1000; // UTC+9
            const jstDate = new Date(date.getTime() + jstOffset);
            return jstDate.toISOString().split('T')[0];
        }

        // ä»Šæ—¥ã®æ—¥ä»˜(JST)
        function getToday() {
            return getJSTDateString(new Date());
        }

        // ç¾åœ¨ã®ãƒ¬ãƒ™ãƒ«æƒ…å ±å–å¾—
        function getCurrentLevel() {
            return appData.levels.find(l => l.id === appData.currentLevel) || appData.levels[0];
        }

        // ãƒ¬ãƒ™ãƒ«ã®é€²æ—å–å¾—
        function getLevelProgress(levelId) {
            const completed = Object.keys(appData.history).filter(date => {
                return appData.history[date].levelId === levelId && appData.history[date].completed;
            }).length;
            return completed;
        }

        // ãƒ¬ãƒ™ãƒ«ãŒå®Œäº†æ¸ˆã¿ã‹ç¢ºèª
        function isLevelCompleted(levelId) {
            return appData.achievements.some(a => a.levelId === levelId);
        }

        // ã‚¿ã‚¹ã‚¯å®Œäº†
        function completeTask() {
            const today = getToday();
            const currentLevel = getCurrentLevel();
            
            if (appData.history[today] && appData.history[today].completed) {
                // ã™ã§ã«å®Œäº†ã—ã¦ã„ã‚‹å ´åˆã¯å–ã‚Šæ¶ˆã—
                delete appData.history[today];
            } else {
                // å®Œäº†è¨˜éŒ²
                appData.history[today] = {
                    levelId: appData.currentLevel,
                    completed: true,
                    task: currentLevel.task
                };
                
                // ãƒ¬ãƒ™ãƒ«é€²æ—ãƒã‚§ãƒƒã‚¯
                const progress = getLevelProgress(appData.currentLevel);
                if (progress >= currentLevel.requiredDays) {
                    // ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—
                    levelUp();
                } else {
                    showCelebration('âœ“ å®Œäº†ï¼\n' + (currentLevel.requiredDays - progress) + 'æ—¥ã§ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼');
                }
            }
            
            updateStats();
            saveData();
            updateAllUI();
        }

        // ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—
        function levelUp() {
            const currentLevel = getCurrentLevel();
            
            // ç‹å† ã‚’ç²å¾—
            if (!isLevelCompleted(appData.currentLevel)) {
                appData.achievements.push({
                    levelId: appData.currentLevel,
                    levelName: currentLevel.name,
                    levelTitle: currentLevel.title,
                    completedDate: getToday(),
                    completedAt: new Date().toISOString()
                });
            }
            
            const nextLevel = appData.levels.find(l => l.id === appData.currentLevel + 1);
            
            if (nextLevel) {
                appData.currentLevel = nextLevel.id;
                showCelebration('ğŸ‘‘ ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼\n' + currentLevel.name + ' ã‚¯ãƒªã‚¢ï¼\n\næ¬¡ã¯ ' + nextLevel.name + '\n' + nextLevel.title);
            } else {
                showCelebration('ğŸ† å…¨ãƒ¬ãƒ™ãƒ«å®Œäº†ï¼\nğŸ‘‘ ' + appData.achievements.length + 'å€‹ã®ç‹å† ç²å¾—ï¼\nãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼');
            }
        }

        // çµ±è¨ˆæ›´æ–°
        function updateStats() {
            const dates = Object.keys(appData.history).filter(d => appData.history[d].completed).sort();
            appData.stats.totalDays = dates.length;

            // ç¾åœ¨ã®é€£ç¶šæ—¥æ•°
            let streak = 0;
            let checkDate = new Date();
            while (true) {
                const dateStr = getJSTDateString(checkDate);
                if (appData.history[dateStr] && appData.history[dateStr].completed) {
                    streak++;
                    checkDate.setDate(checkDate.getDate() - 1);
                } else {
                    break;
                }
            }
            appData.stats.currentStreak = streak;

            // æœ€é•·é€£ç¶š
            let maxStreak = 0;
            let tempStreak = 0;
            let prevDate = null;
            
            for (const dateStr of dates) {
                const currentDate = new Date(dateStr);
                if (prevDate) {
                    const dayDiff = Math.floor((currentDate - prevDate) / (1000 * 60 * 60 * 24));
                    if (dayDiff === 1) {
                        tempStreak++;
                    } else {
                        maxStreak = Math.max(maxStreak, tempStreak);
                        tempStreak = 1;
                    }
                } else {
                    tempStreak = 1;
                }
                prevDate = currentDate;
            }
            maxStreak = Math.max(maxStreak, tempStreak);
            appData.stats.longestStreak = maxStreak;
        }

        // UIå…¨ä½“æ›´æ–°
        function updateAllUI() {
            updateHeader();
            updateCurrentTask();
            updateCalendar();
            updateStatsDisplay();
            updateAchievements();
            updateLevelList();
            updateSettingsList();
        }

        // ãƒ˜ãƒƒãƒ€ãƒ¼æ›´æ–°
        function updateHeader() {
            const level = getCurrentLevel();
            const progress = getLevelProgress(appData.currentLevel);
            const percent = Math.floor((progress / level.requiredDays) * 100);
            
            document.getElementById('headerLevel').textContent = level.name;
            document.getElementById('headerTitle').textContent = level.title;
            document.getElementById('headerSubtitle').textContent = level.subtitle;
            document.getElementById('headerProgress').textContent = progress + '/' + level.requiredDays + 'æ—¥';
            document.getElementById('headerPercent').textContent = percent;
            document.getElementById('headerProgressBar').style.width = percent + '%';
        }

        // ç¾åœ¨ã®ã‚¿ã‚¹ã‚¯æ›´æ–°
        function updateCurrentTask() {
            const level = getCurrentLevel();
            const progress = getLevelProgress(appData.currentLevel);
            const today = getToday();
            const isCompleted = appData.history[today] && appData.history[today].completed;
            
            document.getElementById('taskTitle').textContent = level.task;
            document.getElementById('taskDay').textContent = (progress + 1) + '/' + level.requiredDays + 'æ—¥ç›®';
            document.getElementById('taskStreak').textContent = 'é€£ç¶š' + appData.stats.currentStreak + 'æ—¥';
            
            const button = document.getElementById('completeButton');
            const shareButton = document.getElementById('shareButton');
            
            if (isCompleted) {
                button.textContent = 'âœ“ å®Œäº†æ¸ˆã¿';
                button.classList.add('completed');
                shareButton.disabled = false;
            } else {
                button.textContent = 'âœ“ ä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯å®Œäº†';
                button.classList.remove('completed');
                shareButton.disabled = true;
            }
        }

        // XæŠ•ç¨¿ç”¨ã®ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ
        function generateTweetText() {
            const today = new Date();
            const dateStr = `${today.getFullYear()}å¹´${today.getMonth() + 1}æœˆ${today.getDate()}æ—¥`;
            const level = getCurrentLevel();
            const progress = getLevelProgress(appData.currentLevel);
            const remaining = level.requiredDays - progress;
            
            let text = `ğŸ“š TOEICå­¦ç¿’è¨˜éŒ²\n`;
            text += `${dateStr}\n\n`;
            text += `${level.name}: ${level.title}\n`;
            text += `${progress}æ—¥ç›®å®Œäº†ï¼\n`;
            
            if (remaining > 0) {
                text += `ã‚ã¨${remaining}æ—¥ã§ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ— ğŸ¯\n`;
            } else {
                text += `ãƒ¬ãƒ™ãƒ«å®Œäº†ï¼ğŸ‘‘\n`;
            }
            
            text += `\n#TOEICç¿’æ…£ãƒˆãƒ©ãƒƒã‚«ãƒ¼ #TOEICå­¦ç¿’ #ç¶™ç¶šã¯åŠ›ãªã‚Š`;
            
            return text;
        }

        // XæŠ•ç¨¿ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
        function openShareModal() {
            const tweetText = generateTweetText();
            document.getElementById('tweetPreview').textContent = tweetText;
            
            // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆ
            const charCount = tweetText.length;
            const counter = document.getElementById('charCounter');
            counter.textContent = `${charCount} / 280`;
            
            if (charCount > 280) {
                counter.classList.add('warning');
            } else {
                counter.classList.remove('warning');
            }
            
            document.getElementById('shareModal').classList.add('show');
        }

        // XæŠ•ç¨¿ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeShareModal() {
            document.getElementById('shareModal').classList.remove('show');
        }

        // Xã«æŠ•ç¨¿
        function postToX() {
            const tweetText = generateTweetText();
            const tweetUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(tweetText)}`;
            
            // æ–°ã—ã„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§é–‹ã
            window.open(tweetUrl, '_blank', 'width=550,height=420');
            
            closeShareModal();
            showCelebration('ğŸ¦ Xã®æŠ•ç¨¿ç”»é¢ã‚’é–‹ãã¾ã—ãŸï¼');
        }

        // ç‹å† è¡¨ç¤ºæ›´æ–°
        function updateAchievements() {
            const container = document.getElementById('crownDisplay');
            const section = document.getElementById('achievementsSection');
            
            if (appData.achievements.length === 0) {
                section.style.display = 'none';
                return;
            }
            
            section.style.display = 'block';
            container.innerHTML = '';
            
            // å®Œäº†æ—¥æ™‚ã§ã‚½ãƒ¼ãƒˆï¼ˆæ–°ã—ã„é †ï¼‰
            const sorted = [...appData.achievements].sort((a, b) => 
                new Date(b.completedAt) - new Date(a.completedAt)
            );
            
            sorted.forEach(achievement => {
                const date = new Date(achievement.completedDate);
                const dateStr = `${date.getMonth() + 1}/${date.getDate()}`;
                
                const item = document.createElement('div');
                item.className = 'crown-item';
                item.innerHTML = `
                    <div class="crown-icon">ğŸ‘‘</div>
                    <div class="crown-info">
                        <div class="crown-level">${achievement.levelName}</div>
                        <div class="crown-date">${dateStr} ã‚¯ãƒªã‚¢</div>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æ›´æ–°
        function updateCalendar() {
            const calendar = document.getElementById('calendar');
            calendar.innerHTML = '';
            
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const today = getToday();
            
            let completed = 0;
            let total = 0;
            
            for (let d = new Date(firstDay); d <= lastDay; d.setDate(d.getDate() + 1)) {
                const dateStr = getJSTDateString(d);
                const day = document.createElement('div');
                day.className = 'calendar-day';
                day.textContent = d.getDate();
                
                if (dateStr <= today) {
                    total++;
                    if (appData.history[dateStr] && appData.history[dateStr].completed) {
                        day.classList.add('completed');
                        completed++;
                    } else if (dateStr < today) {
                        day.classList.add('missed');
                    }
                }
                
                if (dateStr === today) {
                    day.classList.add('today');
                }
                
                calendar.appendChild(day);
            }
            
            document.getElementById('monthCompleted').textContent = completed + '/' + total + 'æ—¥';
        }

        // çµ±è¨ˆæ›´æ–°
        function updateStatsDisplay() {
            document.getElementById('totalDays').textContent = appData.stats.totalDays;
            document.getElementById('currentStreak').textContent = appData.stats.currentStreak;
            document.getElementById('longestStreak').textContent = appData.stats.longestStreak;
            
            const now = new Date();
            const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
            const daysInMonth = now.getDate();
            const completedThisMonth = Object.keys(appData.history).filter(date => {
                const d = new Date(date);
                return d >= startOfMonth && d <= now && appData.history[date].completed;
            }).length;
            
            const rate = daysInMonth > 0 ? Math.floor((completedThisMonth / daysInMonth) * 100) : 0;
            document.getElementById('completionRate').textContent = rate;
        }

        // ãƒ¬ãƒ™ãƒ«ä¸€è¦§æ›´æ–°
        function updateLevelList() {
            const list = document.getElementById('levelList');
            list.innerHTML = '';
            
            appData.levels.forEach(level => {
                const progress = getLevelProgress(level.id);
                const completed = isLevelCompleted(level.id);
                const item = document.createElement('div');
                item.className = 'level-item';
                
                let statusClass = 'locked';
                let statusText = 'ãƒ­ãƒƒã‚¯';
                
                if (level.id === appData.currentLevel) {
                    statusClass = 'current';
                    statusText = 'é€²è¡Œä¸­';
                    item.classList.add('current');
                } else if (completed) {
                    statusClass = 'completed';
                    statusText = 'å®Œäº†';
                    item.classList.add('completed');
                }
                
                const crownBadge = completed ? '<span class="crown-badge">ğŸ‘‘</span>' : '';
                
                item.innerHTML = `
                    <div class="level-item-header">
                        <div class="level-name">
                            ${crownBadge}
                            <span>${level.name}: ${level.title}</span>
                        </div>
                        <div class="level-status ${statusClass}">${statusText}</div>
                    </div>
                    <div class="level-description">${level.task}</div>
                    <div class="level-description" style="margin-top: 8px; color: #999;">
                        ${level.id <= appData.currentLevel || completed ? progress + '/' + level.requiredDays + 'æ—¥å®Œäº†' : 'å¿…è¦: ' + level.requiredDays + 'æ—¥'}
                    </div>
                `;
                
                list.appendChild(item);
            });
        }

        // è¨­å®šä¸€è¦§æ›´æ–°
        function updateSettingsList() {
            const list = document.getElementById('settingsLevelList');
            list.innerHTML = '';
            
            appData.levels.forEach(level => {
                const completed = isLevelCompleted(level.id);
                const item = document.createElement('div');
                item.className = 'level-item';
                
                const crownBadge = completed ? '<span class="crown-badge">ğŸ‘‘</span>' : '';
                
                item.innerHTML = `
                    <div class="level-item-header">
                        <div class="level-name">
                            ${crownBadge}
                            <span>${level.name}: ${level.title}</span>
                        </div>
                    </div>
                    <div class="level-description">${level.task}</div>
                    <div class="level-description" style="margin-top: 8px; color: #999;">
                        å¿…è¦æ—¥æ•°: ${level.requiredDays}æ—¥
                    </div>
                    <div class="level-actions">
                        <button class="level-action-btn edit" onclick="editLevel(${level.id})">âœï¸ ç·¨é›†</button>
                        <button class="level-action-btn reset" onclick="confirmResetLevel(${level.id})">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
                    </div>
                `;
                
                list.appendChild(item);
            });
        }

        // ãƒ¬ãƒ™ãƒ«ç·¨é›†
        function editLevel(levelId) {
            const level = appData.levels.find(l => l.id === levelId);
            if (!level) return;
            
            editingLevelId = levelId;
            document.getElementById('editLevelName').value = level.name;
            document.getElementById('editTitle').value = level.title;
            document.getElementById('editSubtitle').value = level.subtitle;
            document.getElementById('editTask').value = level.task;
            document.getElementById('editDays').value = level.requiredDays;
            
            document.getElementById('editModal').classList.add('show');
        }

        // æ–°è¦ãƒ¬ãƒ™ãƒ«è¿½åŠ 
        function addNewLevel() {
            const newId = Math.max(...appData.levels.map(l => l.id)) + 1;
            editingLevelId = null;
            
            document.getElementById('editLevelName').value = 'Level ' + newId;
            document.getElementById('editTitle').value = '';
            document.getElementById('editSubtitle').value = '';
            document.getElementById('editTask').value = '';
            document.getElementById('editDays').value = '10';
            
            document.getElementById('editModal').classList.add('show');
        }

        // ãƒ¬ãƒ™ãƒ«ä¿å­˜
        function saveLevel() {
            const name = document.getElementById('editLevelName').value;
            const title = document.getElementById('editTitle').value;
            const subtitle = document.getElementById('editSubtitle').value;
            const task = document.getElementById('editTask').value;
            const days = parseInt(document.getElementById('editDays').value);
            
            if (!name || !title || !task || !days) {
                alert('ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            if (editingLevelId) {
                // ç·¨é›†
                const level = appData.levels.find(l => l.id === editingLevelId);
                level.name = name;
                level.title = title;
                level.subtitle = subtitle;
                level.task = task;
                level.requiredDays = days;
            } else {
                // æ–°è¦è¿½åŠ 
                const newId = appData.levels.length > 0 ? Math.max(...appData.levels.map(l => l.id)) + 1 : 1;
                appData.levels.push({
                    id: newId,
                    name: name,
                    title: title,
                    subtitle: subtitle,
                    task: task,
                    requiredDays: days
                });
            }
            
            saveData();
            updateAllUI();
            closeEditModal();
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeEditModal() {
            document.getElementById('editModal').classList.remove('show');
        }

        function closeConfirmModal() {
            document.getElementById('confirmModal').classList.remove('show');
            confirmCallback = null;
        }

        // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
        function showConfirm(title, message, callback) {
            document.getElementById('confirmTitle').textContent = title;
            document.getElementById('confirmMessage').textContent = message;
            confirmCallback = callback;
            
            document.getElementById('confirmButton').onclick = () => {
                if (confirmCallback) confirmCallback();
                closeConfirmModal();
            };
            
            document.getElementById('confirmModal').classList.add('show');
        }

        // ãƒ¬ãƒ™ãƒ«ãƒªã‚»ãƒƒãƒˆç¢ºèª
        function confirmResetLevel(levelId) {
            const level = appData.levels.find(l => l.id === levelId);
            showConfirm(
                'ãƒ¬ãƒ™ãƒ«ãƒªã‚»ãƒƒãƒˆ',
                `${level.name}ã®é€²æ—ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\n\nãƒ»å­¦ç¿’å±¥æ­´ãŒå‰Šé™¤ã•ã‚Œã¾ã™\nãƒ»ç²å¾—ã—ãŸç‹å† ãŒå‰Šé™¤ã•ã‚Œã¾ã™\n\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚`,
                () => resetLevel(levelId)
            );
        }

        // ãƒ¬ãƒ™ãƒ«ãƒªã‚»ãƒƒãƒˆå®Ÿè¡Œ
        function resetLevel(levelId) {
            // è©²å½“ãƒ¬ãƒ™ãƒ«ã®å±¥æ­´ã‚’å‰Šé™¤
            Object.keys(appData.history).forEach(date => {
                if (appData.history[date].levelId === levelId) {
                    delete appData.history[date];
                }
            });
            
            // ç‹å† ã‚’å‰Šé™¤
            appData.achievements = appData.achievements.filter(a => a.levelId !== levelId);
            
            // ç¾åœ¨ã®ãƒ¬ãƒ™ãƒ«ãŒãƒªã‚»ãƒƒãƒˆã•ã‚ŒãŸå ´åˆ
            if (appData.currentLevel === levelId) {
                // ä¸€ã¤å‰ã®ãƒ¬ãƒ™ãƒ«ã«æˆ»ã™ï¼ˆæœ€åˆã®ãƒ¬ãƒ™ãƒ«ã®å ´åˆã¯ãã®ã¾ã¾ï¼‰
                const prevLevel = appData.levels.find(l => l.id === levelId - 1);
                if (prevLevel) {
                    appData.currentLevel = prevLevel.id;
                }
            }
            
            updateStats();
            saveData();
            updateAllUI();
            showCelebration('ğŸ”„ ãƒªã‚»ãƒƒãƒˆå®Œäº†\nãƒ¬ãƒ™ãƒ«ãƒ‡ãƒ¼ã‚¿ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸ');
        }

        // å…¨ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆç¢ºèª
        function confirmResetAll() {
            showConfirm(
                'å…¨ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ',
                'âš ï¸ ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\n\nå‰Šé™¤ã•ã‚Œã‚‹ã‚‚ã®ï¼š\nãƒ»å…¨ãƒ¬ãƒ™ãƒ«ã®é€²æ—\nãƒ»å­¦ç¿’å±¥æ­´\nãƒ»ç²å¾—ã—ãŸç‹å† \nãƒ»çµ±è¨ˆãƒ‡ãƒ¼ã‚¿\n\nãƒ¬ãƒ™ãƒ«è¨­å®šã¯ä¿æŒã•ã‚Œã¾ã™ã€‚\n\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚',
                resetAll
            );
        }

        // å…¨ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆå®Ÿè¡Œ
        function resetAll() {
            appData.currentLevel = 1;
            appData.history = {};
            appData.achievements = [];
            appData.stats = {
                totalDays: 0,
                currentStreak: 0,
                longestStreak: 0
            };
            
            saveData();
            updateAllUI();
            showCelebration('ğŸ”„ å…¨ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆå®Œäº†\næ–°ã—ã„ã‚¹ã‚¿ãƒ¼ãƒˆã§ã™ï¼');
        }

        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™
        function resetToDefault() {
            if (confirm('ã™ã¹ã¦ã®ãƒ¬ãƒ™ãƒ«è¨­å®šã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆé€²æ—ãƒ‡ãƒ¼ã‚¿ã¯ä¿æŒã•ã‚Œã¾ã™ï¼‰')) {
                appData.levels = JSON.parse(JSON.stringify(DEFAULT_LEVELS));
                saveData();
                updateAllUI();
            }
        }

        // ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆ
        function switchView(viewName) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            document.getElementById(viewName + 'View').classList.add('active');
            event.currentTarget.classList.add('active');
        }

        // ãŠç¥ã„è¡¨ç¤º
        function showCelebration(message) {
            const celebration = document.getElementById('celebration');
            celebration.innerHTML = message.replace(/\n/g, '<br>');
            celebration.classList.add('show');
            
            setTimeout(() => {
                celebration.classList.remove('show');
            }, 2500);
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚
        window.onload = init;
    </script>
</body>
</html>
